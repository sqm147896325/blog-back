import{d as u,F as d,e as h,f as p,g as f,h as m}from"./Form.250aff68.js";import{S as w,P as b,T as v}from"./TableFormat.602097e9.js";import{n as l}from"./index.54c37f39.js";import"./request.f9ecd988.js";import"./vendor.aabb9fcb.js";var _=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"\u8BBE\u7F6E\u6743\u9650",visible:e.show,"show-close":!1,width:"350px"}},[a("el-tree",{ref:"powerTree",attrs:{data:e.routerPower,"show-checkbox":"","node-key":"name","default-expand-all":"","default-checked-keys":e.powerData,props:e.defaultProps},on:{check:e.powerCheck}}),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("\u53D6\u6D88")]),a("el-button",{attrs:{type:"primary",disabled:e.equally},on:{click:e.save}},[e._v("\u786E\u5B9A")])],1)],1)},g=[];const y={name:"PowerDialog",props:{powerData:{type:Array,default:()=>[]},show:{type:Boolean,default:!1},id:{type:Number,default:0}},data(){return{defaultProps:{children:"children",label:"name"},equally:!0}},watch:{show(e,t){t==!0&&this.$refs.powerTree.setCheckedKeys([])}},computed:{routerPower(){let e=this.$router.options.routes;return e=e.filter(t=>t.name!="\u9996\u9875"),e=this.recursionFilter(e,t=>this.ruleOfFilter(t)),e}},mounted(){},methods:{powerCheck(){let e=this.$refs.powerTree.getCheckedNodes();e=e.map(t=>t.name),e.sort().toString()==[...this.powerData].sort().toString()?this.equally=!0:this.equally=!1},cancel(){this.$emit("update:show",!1)},async save(){let e=this.$refs.powerTree.getCheckedNodes();e=e.map(a=>a.name);let t={id:this.id,power:JSON.stringify(e)};await u(t),this.$emit("update:show",!1),this.$emit("save"),this.equally=!0},recursionFilter(e,t=()=>{}){return e=t(e),e.forEach(a=>(a.children&&(a.children=this.recursionFilter(a.children,()=>t(a.children))),a)),e},ruleOfFilter(e){return e=e.filter(t=>typeof t.show=="boolean"?!1:(t.children&&t.children[1]==null&&delete t.children,!0)),e}}},o={};var k=l(y,_,g,!1,$,"5f1e06d0",null,null);function $(e){for(let t in o)this[t]=o[t]}var F=function(){return k.exports}(),P=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"blog"},[a("el-row",{staticClass:"row",attrs:{gutter:0}},[a("el-col",{attrs:{span:12,offset:0}},[a("my-search",{attrs:{option:e.option},on:{search:e.search,selectchange:e.select},model:{value:e.value,callback:function(s){e.value=s},expression:"value"}})],1),a("el-col",{attrs:{span:2,offset:1}},[a("el-button",{staticClass:"el-icon-plus",attrs:{type:"success",size:"small"},on:{click:e.add}},[e._v("\u6DFB\u52A0")])],1),a("el-col",{attrs:{span:2}},[a("el-button",{attrs:{type:"success",size:"small"},on:{click:e.format}},[e._v("\u683C\u5F0F")])],1)],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userList,border:"",stripe:!0,"header-cell-style":{color:"#606266",fontFamily:"\u5FAE\u8F6F\u96C5\u9ED1"}}},[e._l(e.tableOption,function(s){return[s.cshow?a("el-table-column",{key:s.index,attrs:{prop:s.field,label:s.showname,width:s.width,align:s.align,fixed:s.clock?"right":!1},scopedSlots:e._u([{key:"default",fn:function(c){var r=c.row;return[s.field==="operation"?a("div",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){return e.change(r)}}},[e._v("\u4FEE\u6539\u4FE1\u606F")]),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(i){return e.changePower(r)}}},[e._v("\u4FEE\u6539\u6743\u9650")]),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(i){return e.del(r)}}},[e._v("\u5220\u9664")])],1):a("span",[e._v(" "+e._s(r[s.field])+" ")])]}}],null,!0)}):e._e()]})],2),a("my-pagination",{attrs:{total:e.total},on:{turnPage:e.turnPage,changePagesize:e.changePagesize}}),a("my-form",{attrs:{title:"\u4FEE\u6539\u8D26\u53F7",formdata:e.formdata,row:e.row,rules:e.rules,visible:e.dialogVisible},on:{"update:visible":function(s){e.dialogVisible=s},cancelForm:e.cancelForm,submitFrom:e.submitFrom}}),a("power-dialog",{attrs:{show:e.powerVisible,powerData:e.powerData,id:e.powerId},on:{"update:show":function(s){e.powerVisible=s},save:e.init}}),a("table-format",{attrs:{visible:e.formatVisible,"table-option":e.tableOption},on:{"update:visible":function(s){e.formatVisible=s},setTableOption:e.setTableOption}})],1)},q=[];const x={components:{"my-search":w,"my-form":d,"my-pagination":b,PowerDialog:F,TableFormat:v},data(){return{userList:[],value:"",option:[{label:"\u7528\u6237\u540D",value:"username"},{label:"\u8D26\u53F7id",value:"id"},{label:"\u7535\u8BDD",value:"tel"}],query:{page:1,pagesize:5,query:"",key:"username"},total:0,dialogVisible:!1,formdata:{username:{label:"\u7528\u6237\u540D",value:""},password:{label:"\u5BC6\u7801",value:"",type:"password"},tel:{label:"\u7535\u8BDD",value:""},email:{label:"\u90AE\u7BB1",value:""},des:{label:"\u63CF\u8FF0",value:""}},rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}]},row:{},powerData:[],powerVisible:!1,powerId:0,formatVisible:!1,tableOption:[{field:"username",cname:"\u7528\u6237\u540D",cshow:!0,align:"center",showname:"\u7528\u6237\u540D",clock:!1,width:100},{field:"id",cname:"\u8D26\u53F7id",cshow:!0,align:"center",showname:"\u8D26\u53F7id",clock:!1,width:80},{field:"tel",cname:"\u7535\u8BDD",cshow:!0,align:"center",showname:"\u7535\u8BDD",clock:!1,width:120},{field:"email",cname:"\u90AE\u7BB1",cshow:!0,align:"center",showname:"\u90AE\u7BB1",clock:!1,width:180},{field:"des",cname:"\u63CF\u8FF0",cshow:!0,align:"center",showname:"\u63CF\u8FF0",clock:!1},{field:"operation",cname:"\u64CD\u4F5C",cshow:!0,align:"center",showname:"\u64CD\u4F5C",clock:!0,width:280}]}},mounted(){this.init()},methods:{async init(){await this.search()},select(e){this.query.key=e,this.search()},async search(){this.query.query=this.value;let{dataInfo:e}=await h(this.query);this.total=e.count,this.userList=e.rows},add(){this.resetFormdata(),this.dialogVisible=!0},format(){this.formatVisible=!0},change(e){e.password="",this.row=e,this.dialogVisible=!0},changePower(e){this.powerData=JSON.parse(e.power)||[],this.powerId=e.id,this.powerVisible=!0},async del(e){let t=`\u5220\u9664${e.id}`;this.$confirm(`\u662F\u5426${t}`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(async()=>{await p({id:e.id}),this.$message.success(`${t}\u6210\u529F!`),this.init()}).catch(()=>{this.$message.info(`\u5DF2\u53D6\u6D88${t}`)})},async turnPage(e){this.query.page=e,this.search()},async changePagesize(e){this.query.pagesize=e,this.search()},cancelForm(){this.dialogVisible=!1},resetFormdata(){this.row={}},async submitFrom(e,t){this.dialogVisible=!1,t==1?await f(e):await m(e),await this.init()},setTableOption(e){this.tableOption=e}}},n={};var V=l(x,P,q,!1,T,"30949e9c",null,null);function T(e){for(let t in n)this[t]=n[t]}var j=function(){return V.exports}();export{j as default};
