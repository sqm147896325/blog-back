{"version":3,"file":"login.039dea39.js","sources":["../../src/views/main/login.vue?vue&type=template&lang.js","../../src/views/main/login.vue"],"sourcesContent":["\n<div class=\"login\">\n\t<div class=\"title\">LS后台</div>\n\t<div class=\"card\">\n\t\t<el-form :model=\"loginInfo\" :rules=\"rules\" ref=\"loginForm\" class='loginForm'>\n\t\t\t<el-form-item prop=\"id\" class=\"item\">\n\t\t\t\t<el-input placeholder=\"请输入id或邮箱\" v-model=\"loginInfo.id\" @keyup.enter.native=\"login\">\n\t\t\t\t\t<template slot=\"prepend\">账号</template>\n\t\t\t\t</el-input>\n\t\t\t</el-form-item>\n\t\t\t<el-form-item prop=\"password\" class=\"item\">\n\t\t\t\t<el-input placeholder=\"请输入密码\" v-model=\"loginInfo.password\" @keyup.enter.native=\"login\" show-password>\n\t\t\t\t\t<template slot=\"prepend\">密码</template>\n\t\t\t\t</el-input>\n\t\t\t</el-form-item>\n\t\t\t<div class=\"item-button\">\n\t\t\t\t<el-button class=\"login-btn\" @click=\"login\" type=\"info\">登录</el-button>\n\t\t\t\t<div class=\"function-btn\" @click=\"registerOrForget\" size=\"small\" type=\"text\">注册/忘记密码</div>\n\t\t\t</div>\n\t\t</el-form>\n\t</div>\n\t<my-form ref=\"myForm\" :title=\"title\" :formdata=\"formdata\" :row=\"bindData\" :rules=\"rules\" :visible.sync=\"dialogVisible\" @cancelForm=\"handleClose\" @submitFrom=\"submitFrom\">\n\t\t<template v-slot:verification=\"{ allRow, rowKey }\">\n\t\t\t<el-input v-model=\"allRow[rowKey]\">\n\t\t\t\t<el-button slot=\"append\" @click=\"getVerification\" :disabled=\"verificationText !== '获取验证码'\" :loading=\"verificationText === 'loading'\">{{['获取验证码', 'loading'].includes(verificationText) ? '获取验证码' : verificationText + '秒后可再次获取'}}</el-button>\n\t\t\t</el-input>\n\t\t</template>\n\t</my-form>\n</div>\n","<template>\r\n\t<div class=\"login\">\r\n\t\t<div class=\"title\">LS后台</div>\r\n\t\t<div class=\"card\">\r\n\t\t\t<el-form :model=\"loginInfo\" :rules=\"rules\" ref=\"loginForm\" class='loginForm'>\r\n\t\t\t\t<el-form-item prop=\"id\" class=\"item\">\r\n\t\t\t\t\t<el-input placeholder=\"请输入id或邮箱\" v-model=\"loginInfo.id\" @keyup.enter.native=\"login\">\r\n\t\t\t\t\t\t<template slot=\"prepend\">账号</template>\r\n\t\t\t\t\t</el-input>\r\n\t\t\t\t</el-form-item>\r\n\t\t\t\t<el-form-item prop=\"password\" class=\"item\">\r\n\t\t\t\t\t<el-input placeholder=\"请输入密码\" v-model=\"loginInfo.password\" @keyup.enter.native=\"login\" show-password>\r\n\t\t\t\t\t\t<template slot=\"prepend\">密码</template>\r\n\t\t\t\t\t</el-input>\r\n\t\t\t\t</el-form-item>\r\n\t\t\t\t<div class=\"item-button\">\r\n\t\t\t\t\t<el-button class=\"login-btn\" @click=\"login\" type=\"info\">登录</el-button>\r\n\t\t\t\t\t<div class=\"function-btn\" @click=\"registerOrForget\" size=\"small\" type=\"text\">注册/忘记密码</div>\r\n\t\t\t\t</div>\r\n\t\t\t</el-form>\r\n\t\t</div>\r\n\t\t<my-form ref=\"myForm\" :title=\"title\" :formdata=\"formdata\" :row=\"bindData\" :rules=\"rules\" :visible.sync=\"dialogVisible\" @cancelForm=\"handleClose\" @submitFrom=\"submitFrom\">\r\n\t\t\t<template v-slot:verification=\"{ allRow, rowKey }\">\r\n\t\t\t\t<el-input v-model=\"allRow[rowKey]\">\r\n\t\t\t\t\t<el-button slot=\"append\" @click=\"getVerification\" :disabled=\"verificationText !== '获取验证码'\" :loading=\"verificationText === 'loading'\">{{['获取验证码', 'loading'].includes(verificationText) ? '获取验证码' : verificationText + '秒后可再次获取'}}</el-button>\r\n\t\t\t\t</el-input>\r\n\t\t\t</template>\r\n\t\t</my-form>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport { apiPostLogin, apiToolEmailVerify, apiToolEmailSetUser } from '@/api/user.js';\r\nimport From from '@/components/Form/Form.vue';\r\n\r\nexport default {\r\n\tname: 'login',\r\n\tcomponents: { 'my-form': From },\r\n\tdata(){\r\n\t\treturn{\r\n\t\t\tloginInfo: {\r\n\t\t\t\tid: new String,\r\n\t\t\t\tpassword: new String\r\n\t\t\t},\r\n\t\t\trules: {\r\n\t\t\t\tid: [\r\n\t\t\t\t\t{ required: true, message: '请输入id或邮箱', trigger: 'blur' },\r\n\t\t\t\t\t{ min: 1, message: '请输入账号id或绑定邮箱', trigger: 'blur' }\r\n\t\t\t\t],\r\n\t\t\t\temail: [\r\n\t\t\t\t\t{ required: true, message: '请输入邮箱', trigger: 'blur' },\r\n\t\t\t\t\t{ type: 'email', message: '请输入正确的邮箱地址', trigger: ['blur', 'change'] },\r\n\t\t\t\t],\r\n\t\t\t\tpassword: [\r\n\t\t\t\t\t{ required: true, message: '请输入密码', trigger: 'blur' },\r\n\t\t\t\t\t{ min: 6, max: 20, message: '密码在6-20个字符', trigger: 'blur' }\r\n\t\t\t\t],\r\n\t\t\t\trePassword: [\r\n\t\t\t\t\t{ required: true, validator: this.reSure, trigger: 'blur' }\r\n\t\t\t\t],\r\n\t\t\t\tverification: [\r\n\t\t\t\t\t{ required: true, message: '请输入验证码', trigger: 'blur' },\r\n\t\t\t\t\t{ min: 4, max: 4, message: '验证码为4个字符', trigger: 'blur' }\r\n\t\t\t\t]\r\n\t\t\t},\r\n\t\t\tformdata: {\r\n\t\t\t\temail: {label: '邮箱',value: ''},\r\n\t\t\t\tverification: {label: '验证码',value: ''},\r\n\t\t\t\tpassword: {label: '密码',value: '', type: 'password'},\r\n\t\t\t\trePassword: {label: '确认密码',value: '', type: 'password'},\r\n\t\t\t},\t// 表单\r\n\t\t\tbindData: {\r\n\t\t\t\tusername: '',\r\n\t\t\t\temail: '',\r\n\t\t\t\tpassword: '',\r\n\t\t\t\trePassword: '',\r\n\t\t\t},\r\n\t\t\ttitle: '注册',\r\n\t\t\tverificationText: '获取验证码',\r\n\t\t\tdialogVisible: false,\r\n\t\t\tverificationData: ''\r\n\t\t}\r\n\t},\r\n\tmounted(){\r\n\t\tthis.init();\r\n\t},\r\n\tmethods: {\r\n\t\tinit(){\r\n\r\n\t\t},\r\n\t\tlogin(){\r\n\t\t\tthis.$refs['loginForm'].validate(async (valid) => {\r\n\t\t\t\tif (!valid) {\r\n\t\t\t\t\tconsole.log('[login] 校验失败')\r\n\t\t\t\t}else{\r\n\t\t\t\t\tlet res = await apiPostLogin(this.loginInfo);\r\n\t\t\t\t\t// 存在res且flag为1则表示登录成功\r\n\t\t\t\t\tif(res?.flag == 1){\r\n\t\t\t\t\t\tlocalStorage.setItem('token',res.dataInfo.token);\r\n\t\t\t\t\t\tlet userInfo = res.dataInfo.userInfo;\r\n\t\t\t\t\t\tlocalStorage.setItem('userInfo',JSON.stringify(userInfo));\r\n\t\t\t\t\t\tthis.$store.commit('user/setUserInfo',userInfo);\r\n\t\t\t\t\t\tthis.$router.push('/');\r\n\t\t\t\t\t\tthis.$message.success('登录成功');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},\r\n\t\tregisterOrForget() {\r\n\t\t\tthis.dialogVisible = true\r\n\t\t\tthis.title = '注册/忘记密码'\r\n\t\t},\r\n\t\thandleClose() {\r\n\r\n\t\t},\r\n\t\tasync submitFrom(data, type) {\r\n\t\t\tawait apiToolEmailSetUser({ email: data.email, verification: data.verification , password: data.password })\r\n\t\t},\r\n\r\n\t\t/* 注册登录相关 */\r\n\t\t// 校验两次密码是否一致\r\n\t\treSure(rule, value, callback) {\r\n\t\t\tconsole.log(this.$refs.myForm)\r\n\t\t\tif (value === '') {\r\n\t\t\t\tcallback(new Error('请再次输入密码'))\r\n\t\t\t\t// password 是表单上绑定的字段\r\n\t\t\t} else if (value !== this.$refs.myForm.rowData.password) {\r\n\t\t\t\tcallback(new Error('两次输入密码不一致'))\r\n\t\t\t} else {\r\n\t\t\t\tcallback()\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 获取验证码\r\n\t\tasync getVerification() {\r\n\t\t\tthis.$refs.myForm.$refs.form.validateField('email', async(errorMessage) => {\r\n\t\t\t\tif (!errorMessage) {\r\n\t\t\t\t\tapiToolEmailVerify({ email: this.$refs.myForm.rowData.email }).then(() => {\r\n\t\t\t\t\t\tthis.verificationText = 60\r\n\t\t\t\t\t\t\tlet timer = setInterval(() => {\r\n\t\t\t\t\t\t\tthis.verificationText--\r\n\t\t\t\t\t\t\tif (this.verificationText === 0) {\r\n\t\t\t\t\t\t\t\tthis.verificationText = '获取验证码'\r\n\t\t\t\t\t\t\t\tclearInterval(timer)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, 1000)\r\n\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\tthis.verificationText = '获取验证码'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.verificationText = 'loading'\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.$message.error('请先输入正确邮箱')\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.login{\r\n\tposition: relative;\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n\theight: 100vh;\r\n\twidth: 100vw;\r\n\tbackground: @bg-other;\r\n}\r\n.title{\r\n\tposition: absolute;\r\n\ttop: 120px;\r\n\tfont-size: @fz-big-title;\r\n\tfont-family: '微软雅黑';\r\n\tletter-spacing: 10px;\r\n\tbackground-clip: text;\r\n\tcolor: @c-black;\r\n}\r\n.card{\r\n\theight: 200px;\r\n\twidth: 300px;\r\n\tbackground: @bg-bar;\r\n\tpadding: 20px;\r\n\tbox-shadow: 10px 10px 5px #666666;\r\n\topacity: 0.9;\r\n\tborder-radius: 10px;\r\n\r\n}\r\n.loginForm{\r\n\tpadding-top: 20px;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n\t.item{\r\n\t\twidth: 100%;\r\n\t}\r\n}\r\n.item-button{\r\n\tdisplay: flex;\r\n\tjustify-content: flex-end;\r\n\talign-items: flex-end;\r\n\twidth: 100%;\r\n\t.login-btn{\r\n\t\tmargin-right: 150px;\r\n\t}\r\n\t.function-btn{\r\n\t\tcolor: #fff;\r\n\t\tfont-size: @fz-small;\r\n\t\tcursor: pointer;\r\n\t\ttext-decoration: underline;\r\n\t}\r\n}\r\n</style>\r\n"],"names":[],"mappings":"+JAAA,GAAI,GAAS,UAAY,CAAC,GAAI,GAAI,KAAS,EAAG,EAAI,eAAmB,EAAG,EAAI,MAAM,IAAI,EAAG,MAAO,GAAG,MAAM,CAAC,YAAY,SAAS,CAAC,EAAG,MAAM,CAAC,YAAY,SAAS,CAAC,EAAI,GAAG,oBAAU,EAAG,MAAM,CAAC,YAAY,QAAQ,CAAC,EAAG,UAAU,CAAC,IAAI,YAAY,YAAY,YAAY,MAAM,CAAC,MAAQ,EAAI,UAAU,MAAQ,EAAI,QAAQ,CAAC,EAAG,eAAe,CAAC,YAAY,OAAO,MAAM,CAAC,KAAO,OAAO,CAAC,EAAG,WAAW,CAAC,MAAM,CAAC,YAAc,0CAAY,SAAS,CAAC,MAAQ,SAAS,EAAO,CAAC,MAAG,CAAC,EAAO,KAAK,QAAQ,QAAQ,EAAI,GAAG,EAAO,QAAQ,QAAQ,GAAG,EAAO,IAAI,SAAkB,KAAc,EAAI,MAAM,MAAM,KAAM,aAAa,MAAM,CAAC,MAAO,EAAI,UAAU,GAAI,SAAS,SAAU,EAAK,CAAC,EAAI,KAAK,EAAI,UAAW,KAAM,IAAM,WAAW,iBAAiB,CAAC,EAAG,WAAW,CAAC,KAAK,WAAW,CAAC,EAAI,GAAG,mBAAS,IAAI,GAAG,EAAG,eAAe,CAAC,YAAY,OAAO,MAAM,CAAC,KAAO,aAAa,CAAC,EAAG,WAAW,CAAC,MAAM,CAAC,YAAc,iCAAQ,gBAAgB,IAAI,SAAS,CAAC,MAAQ,SAAS,EAAO,CAAC,MAAG,CAAC,EAAO,KAAK,QAAQ,QAAQ,EAAI,GAAG,EAAO,QAAQ,QAAQ,GAAG,EAAO,IAAI,SAAkB,KAAc,EAAI,MAAM,MAAM,KAAM,aAAa,MAAM,CAAC,MAAO,EAAI,UAAU,SAAU,SAAS,SAAU,EAAK,CAAC,EAAI,KAAK,EAAI,UAAW,WAAY,IAAM,WAAW,uBAAuB,CAAC,EAAG,WAAW,CAAC,KAAK,WAAW,CAAC,EAAI,GAAG,mBAAS,IAAI,GAAG,EAAG,MAAM,CAAC,YAAY,eAAe,CAAC,EAAG,YAAY,CAAC,YAAY,YAAY,MAAM,CAAC,KAAO,QAAQ,GAAG,CAAC,MAAQ,EAAI,QAAQ,CAAC,EAAI,GAAG,kBAAQ,EAAG,MAAM,CAAC,YAAY,eAAe,MAAM,CAAC,KAAO,QAAQ,KAAO,QAAQ,GAAG,CAAC,MAAQ,EAAI,mBAAmB,CAAC,EAAI,GAAG,4CAAc,IAAI,IAAI,GAAG,EAAG,UAAU,CAAC,IAAI,SAAS,MAAM,CAAC,MAAQ,EAAI,MAAM,SAAW,EAAI,SAAS,IAAM,EAAI,SAAS,MAAQ,EAAI,MAAM,QAAU,EAAI,eAAe,GAAG,CAAC,iBAAiB,SAAS,EAAO,CAAC,EAAI,cAAc,GAAQ,WAAa,EAAI,YAAY,WAAa,EAAI,YAAY,YAAY,EAAI,GAAG,CAAC,CAAC,IAAI,eAAe,GAAG,SAAS,EAAI,CACx1D,GAAI,GAAS,EAAI,OACb,EAAS,EAAI,OACjB,MAAO,CAAC,EAAG,WAAW,CAAC,MAAM,CAAC,MAAO,EAAO,GAAS,SAAS,SAAU,EAAK,CAAC,EAAI,KAAK,EAAQ,EAAQ,IAAM,WAAW,mBAAmB,CAAC,EAAG,YAAY,CAAC,MAAM,CAAC,KAAO,SAAS,SAAW,EAAI,mBAAqB,iCAAQ,QAAU,EAAI,mBAAqB,WAAW,GAAG,CAAC,MAAQ,EAAI,iBAAiB,KAAK,UAAU,CAAC,EAAI,GAAG,EAAI,GAAG,CAAC,iCAAS,WAAW,SAAS,EAAI,kBAAoB,iCAAU,EAAI,iBAAmB,kDAAe,WAAW,IACzb,EAAkB,GC+BtB"}