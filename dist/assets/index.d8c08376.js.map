{"version":3,"file":"index.d8c08376.js","sources":["../../src/views/application/networkDisk/index.vue?vue&type=template&lang.js","../../src/views/application/networkDisk/index.vue"],"sourcesContent":["\n  <div>\n\t<div class=\"title-bar\">\n\t\t<div class=\"left\">\n\t\t\t<el-button :disabled=\"backId.length == 0\" type=\"primary\" size=\"small\" @click=\"back\">返回</el-button>\n\t\t\t<el-button :disabled=\"checkArr.length == 0\" type=\"danger\" size=\"small\" @click=\"del\">删除</el-button>\n\t\t</div>\n\t\t<div class=\"right\">\n\t\t\t<el-button :disabled=\"checkArr.length == 0\" type=\"primary\" size=\"small\" @click=\"downFile\">下载</el-button>\n\t\t\t<el-button type=\"success\" size=\"small\" @click=\"mkdir\">新建文件夹</el-button>\n\t\t\t<el-button type=\"primary\" size=\"small\" @click=\"upload\">上传</el-button>\n\t\t</div>\n\t</div>\n\t<el-table ref=\"table\" highlight-current-row :data=\"tableData\" @row-dblclick=\"rowDblclick\" @row-click=\"rowClick\" @selection-change=\"checkChange\">\n\t\t<el-table-column type=\"selection\" width=\"55\"></el-table-column>\n\t\t<el-table-column label=\"名称\" width=\"200\">\n\t\t\t<template slot-scope=\"{ row }\">\n\t\t\t\t{{row | filterFlieName}}\n\t\t\t</template>\n\t\t</el-table-column>\n\t\t<el-table-column prop=\"size\" label=\"大小\" width=\"100\"></el-table-column>\n\t\t<el-table-column prop=\"upload_time\" label=\"上传时间\"></el-table-column>\n\t</el-table>\n\t<el-dialog title=\"上传文件\" :visible.sync=\"visible\" width=\"400\">\n\t\t<el-upload class=\"upload-center\" drag action :http-request=\"uploadSectionFile\" :on-change=\"flieChange\" :on-remove=\"flieChange\" multiple>\n\t\t\t<i class=\"el-icon-upload\"></i>\n\t\t\t<div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\n\t\t\t<div class=\"el-upload__tip\" slot=\"tip\">只能上传文件，且单个大小不超过100mb</div>\n\t\t</el-upload>\n\t\t<span slot=\"footer\">\n\t\t\t<el-button @click=\"visible = false\" size=\"small\">取消</el-button>\n\t\t\t<el-button type=\"primary\" @click=\"save\" size=\"small\">上传至此</el-button>\n\t\t</span>\n\t</el-dialog>\n\t\n  </div>\n","<template>\r\n  <div>\r\n\t<div class=\"title-bar\">\r\n\t\t<div class=\"left\">\r\n\t\t\t<el-button :disabled=\"backId.length == 0\" type=\"primary\" size=\"small\" @click=\"back\">返回</el-button>\r\n\t\t\t<el-button :disabled=\"checkArr.length == 0\" type=\"danger\" size=\"small\" @click=\"del\">删除</el-button>\r\n\t\t</div>\r\n\t\t<div class=\"right\">\r\n\t\t\t<el-button :disabled=\"checkArr.length == 0\" type=\"primary\" size=\"small\" @click=\"downFile\">下载</el-button>\r\n\t\t\t<el-button type=\"success\" size=\"small\" @click=\"mkdir\">新建文件夹</el-button>\r\n\t\t\t<el-button type=\"primary\" size=\"small\" @click=\"upload\">上传</el-button>\r\n\t\t</div>\r\n\t</div>\r\n\t<el-table ref=\"table\" highlight-current-row :data=\"tableData\" @row-dblclick=\"rowDblclick\" @row-click=\"rowClick\" @selection-change=\"checkChange\">\r\n\t\t<el-table-column type=\"selection\" width=\"55\"></el-table-column>\r\n\t\t<el-table-column label=\"名称\" width=\"200\">\r\n\t\t\t<template slot-scope=\"{ row }\">\r\n\t\t\t\t{{row | filterFlieName}}\r\n\t\t\t</template>\r\n\t\t</el-table-column>\r\n\t\t<el-table-column prop=\"size\" label=\"大小\" width=\"100\"></el-table-column>\r\n\t\t<el-table-column prop=\"upload_time\" label=\"上传时间\"></el-table-column>\r\n\t</el-table>\r\n\t<el-dialog title=\"上传文件\" :visible.sync=\"visible\" width=\"400\">\r\n\t\t<el-upload class=\"upload-center\" drag action :http-request=\"uploadSectionFile\" :on-change=\"flieChange\" :on-remove=\"flieChange\" multiple>\r\n\t\t\t<i class=\"el-icon-upload\"></i>\r\n\t\t\t<div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n\t\t\t<div class=\"el-upload__tip\" slot=\"tip\">只能上传文件，且单个大小不超过100mb</div>\r\n\t\t</el-upload>\r\n\t\t<span slot=\"footer\">\r\n\t\t\t<el-button @click=\"visible = false\" size=\"small\">取消</el-button>\r\n\t\t\t<el-button type=\"primary\" @click=\"save\" size=\"small\">上传至此</el-button>\r\n\t\t</span>\r\n\t</el-dialog>\r\n\t\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { apiPostFlie, apiPutFlie, apiDeleteFile , apiPutDir } from '@/api/app.js'\r\nexport default {\r\n\tname: 'networkDisk',\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tvisible: false,\r\n\t\t\ttableData: [],\r\n\t\t\tpath: '/',\t\t// 当前路径，默认为'/'\r\n\t\t\tuuid: 0,\t\t// 当前目录的id,默认为0\r\n\t\t\tfileList: [],\t// 文件列表\r\n\t\t\tbackId: [],\t\t// 需要返回的id\r\n\t\t\tcheckArr: []\t// 选中的数组\r\n\t\t}\r\n\t},\r\n\tasync mounted() {\r\n\t\tawait this.init()\r\n\t},\r\n\tfilters: {\r\n\t\tfilterFlieName(row) {\r\n\t\t\tif(row.file_type == 'dir'){\r\n\t\t\t\treturn row.name;\r\n\t\t\t}\r\n\t\t\treturn row.name + row.file_type;\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tasync init() {\r\n\t\t\tawait this.postFile();\r\n\t\t},\r\n\r\n\t\t/* 顶部按钮相关 */\r\n\t\t// 点击返回\r\n\t\tasync back() {\r\n\t\t\tthis.uuid = this.backId.pop();\r\n\t\t\tawait this.init();\r\n\t\t},\r\n\t\t// 删除\r\n\t\tasync del() {\r\n\t\t\tlet delArr = this.checkArr.map(e => e.uuid);\r\n\t\t\tlet res = await this.deleteFile({delArr,user_id:this.$store.state.user.userInfo.id});\r\n\t\t\tawait this.init();\r\n\t\t},\r\n\t\t// 下载\r\n\t\tasync downFile() {\r\n\t\t\tlet downloadArr = this.checkArr.map(e => e.uuid);\r\n\t\t\t// 使用window.open()下载文件流\r\n\t\t\twindow.open(`${import.meta.env.VITE_APP_BASE_PATH}/file/download?downloadArr=${downloadArr}&user_id=${this.$store.state.user.userInfo.id}`)\r\n\t\t},\r\n\t\t// 创建文件夹\r\n\t\tasync mkdir(){\r\n\t\t\tlet msg = '新建文件夹'\r\n\t\t\tthis.$prompt('请输入文件夹名称',msg, {\r\n\t\t\t\tconfirmButtonText: '确定',\r\n\t\t\t\tcancelButtonText: '取消',\r\n\t\t\t\tinputValidator: (value) => value !== '' && value !== null ,\r\n\t\t\t\tinputErrorMessage: '名称不能为空',\r\n\t\t\t\ttype: 'warning'\r\n\t\t\t}).then(async ({ value }) => {\r\n\t\t\t\tconst name = value\r\n\t\t\t\tlet params = {\r\n\t\t\t\t\tparentId: this.uuid,\r\n\t\t\t\t\tuser_id:this.$store.state.user.userInfo.id,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tsize: '0kb'\r\n\t\t\t\t}\r\n\t\t\t\tawait this.putDir(params);\r\n\t\t\t\tthis.$message.success(`${msg}成功!`);\r\n\t\t\t\tawait this.init();\r\n\t\t\t}).catch((err) => {\r\n\t\t\t\tconsole.error('错误捕捉', err)\r\n\t\t\t\tthis.$message.info(`已取消${msg}`);\r\n\t\t\t});\r\n\t\t},\r\n\t\t// 点击上传\r\n\t\tupload(){\r\n\t\t\tthis.visible = true;\r\n\t\t},\r\n\r\n\t\t/* 表格相关 */\r\n\t\t// 行单击\r\n\t\trowClick(row,col) {\r\n\t\t\tthis.$refs.table.toggleRowSelection(row)\r\n\t\t},\r\n\t\t// 行双击\r\n\t\tasync rowDblclick(row,col) {\r\n\t\t\tif( row.file_type == 'dir' ) {\r\n\t\t\t\tthis.backId.push(this.uuid);\r\n\t\t\t\tthis.uuid = row.uuid;\r\n\t\t\t\tawait this.init();\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 勾选改变回调\r\n\t\tcheckChange(check) {\r\n\t\t\tthis.checkArr = check;\r\n\t\t\tconsole.log(this.checkArr)\r\n\t\t},\r\n\r\n\t\t/* 上传文件遮罩 */\r\n\t\t// 覆盖默认的上传文件方法\r\n\t\tuploadSectionFile(params) {\r\n\t\t\tconst file = params.file;\r\n            const isLt = file.size / 1024 / 1024 < 100;\r\n\t\t\tif (!isLt) {\r\n\t\t\t\tthis.$message.error(\"只能上传文件大小小于100M\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t// 文件改变\r\n\t\tflieChange(file,fileList) {\r\n\t\t\tthis.fileList = fileList;\r\n\t\t},\r\n\t\t// 保存\r\n\t\tasync save() {\r\n\t\t\tconst form = new FormData();\r\n\t\t\tif(this.fileList.length >= 1){\r\n\t\t\t\tthis.fileList.map(e => {\r\n\t\t\t\t\tform.append('file', e.raw);\r\n\t\t\t\t})\r\n\t\t\t\tform.append('parentId',this.uuid);\r\n\t\t\t\tform.append('user_id',this.$store.state.user.userInfo.id);\r\n\t\t\t\tawait this.putFile(form);\r\n\t\t\t\tthis.visible = false;\r\n\t\t\t\tawait this.init();\r\n\t\t\t} else  {\r\n\t\t\t\tthis.$message.warning('请选择上传的文件');\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t/* 请求相关 */\r\n\t\t// 获取文件或文件夹相关信息\r\n\t\tasync postFile() {\r\n\t\t\tlet res = await apiPostFlie({uuid:this.uuid,user_id:this.$store.state.user.userInfo.id});\r\n\t\t\tthis.tableData = res.dataInfo.content;\r\n\t\t},\r\n\t\t// 存入文件\r\n\t\tasync putFile(params) {\r\n\t\t\tlet res = await apiPutFlie(params);\r\n\t\t},\r\n\t\t// 存入文件夹\r\n\t\tasync putDir(params) {\r\n\t\t\tlet res = await apiPutDir(params);\r\n\t\t},\r\n\t\t// 删除文件或文件夹\r\n\t\tasync deleteFile(params) {\r\n\t\t\tlet res = await apiDeleteFile(params);\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.title-bar{\r\n\tdisplay: flex;\r\n\tjustify-content: space-between;\r\n\tpadding-bottom: 20px;\r\n\t.left{\r\n\t\tdisplay: flex;\r\n\t}\r\n\t.right{\r\n\t\tdisplay: flex;\r\n\t}\r\n}\r\n.upload-center{\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n}\r\n</style>"],"names":[],"mappings":"8JAAA,GAAI,GAAS,UAAY,CAAC,GAAI,GAAI,KAAS,EAAG,EAAI,eAAmB,EAAG,EAAI,MAAM,IAAI,EAAG,MAAO,GAAG,MAAM,CAAC,EAAG,MAAM,CAAC,YAAY,aAAa,CAAC,EAAG,MAAM,CAAC,YAAY,QAAQ,CAAC,EAAG,YAAY,CAAC,MAAM,CAAC,SAAW,EAAI,OAAO,QAAU,EAAE,KAAO,UAAU,KAAO,SAAS,GAAG,CAAC,MAAQ,EAAI,OAAO,CAAC,EAAI,GAAG,kBAAQ,EAAG,YAAY,CAAC,MAAM,CAAC,SAAW,EAAI,SAAS,QAAU,EAAE,KAAO,SAAS,KAAO,SAAS,GAAG,CAAC,MAAQ,EAAI,MAAM,CAAC,EAAI,GAAG,mBAAS,GAAG,EAAG,MAAM,CAAC,YAAY,SAAS,CAAC,EAAG,YAAY,CAAC,MAAM,CAAC,SAAW,EAAI,SAAS,QAAU,EAAE,KAAO,UAAU,KAAO,SAAS,GAAG,CAAC,MAAQ,EAAI,WAAW,CAAC,EAAI,GAAG,kBAAQ,EAAG,YAAY,CAAC,MAAM,CAAC,KAAO,UAAU,KAAO,SAAS,GAAG,CAAC,MAAQ,EAAI,QAAQ,CAAC,EAAI,GAAG,oCAAW,EAAG,YAAY,CAAC,MAAM,CAAC,KAAO,UAAU,KAAO,SAAS,GAAG,CAAC,MAAQ,EAAI,SAAS,CAAC,EAAI,GAAG,mBAAS,KAAK,EAAG,WAAW,CAAC,IAAI,QAAQ,MAAM,CAAC,wBAAwB,GAAG,KAAO,EAAI,WAAW,GAAG,CAAC,eAAe,EAAI,YAAY,YAAY,EAAI,SAAS,mBAAmB,EAAI,cAAc,CAAC,EAAG,kBAAkB,CAAC,MAAM,CAAC,KAAO,YAAY,MAAQ,QAAQ,EAAG,kBAAkB,CAAC,MAAM,CAAC,MAAQ,eAAK,MAAQ,OAAO,YAAY,EAAI,GAAG,CAAC,CAAC,IAAI,UAAU,GAAG,SAAS,EAAI,CACroC,GAAI,GAAM,EAAI,IACd,MAAO,CAAC,EAAI,GAAG,IAAI,EAAI,GAAG,EAAI,GAAG,kBAAkB,IAAM,YAAY,EAAG,kBAAkB,CAAC,MAAM,CAAC,KAAO,OAAO,MAAQ,eAAK,MAAQ,SAAS,EAAG,kBAAkB,CAAC,MAAM,CAAC,KAAO,cAAc,MAAQ,+BAAW,GAAG,EAAG,YAAY,CAAC,MAAM,CAAC,MAAQ,2BAAO,QAAU,EAAI,QAAQ,MAAQ,OAAO,GAAG,CAAC,iBAAiB,SAAS,EAAO,CAAC,EAAI,QAAQ,KAAU,CAAC,EAAG,YAAY,CAAC,YAAY,gBAAgB,MAAM,CAAC,KAAO,GAAG,OAAS,GAAG,eAAe,EAAI,kBAAkB,YAAY,EAAI,WAAW,YAAY,EAAI,WAAW,SAAW,KAAK,CAAC,EAAG,IAAI,CAAC,YAAY,mBAAmB,EAAG,MAAM,CAAC,YAAY,mBAAmB,CAAC,EAAI,GAAG,0DAAa,EAAG,KAAK,CAAC,EAAI,GAAG,gCAAY,EAAG,MAAM,CAAC,YAAY,iBAAiB,MAAM,CAAC,KAAO,OAAO,KAAK,OAAO,CAAC,EAAI,GAAG,uGAA4B,EAAG,OAAO,CAAC,MAAM,CAAC,KAAO,UAAU,KAAK,UAAU,CAAC,EAAG,YAAY,CAAC,MAAM,CAAC,KAAO,SAAS,GAAG,CAAC,MAAQ,SAAS,EAAO,CAAC,EAAI,QAAU,MAAS,CAAC,EAAI,GAAG,kBAAQ,EAAG,YAAY,CAAC,MAAM,CAAC,KAAO,UAAU,KAAO,SAAS,GAAG,CAAC,MAAQ,EAAI,OAAO,CAAC,EAAI,GAAG,+BAAW,IAAI,IAAI,IACpgC,EAAkB,GCqCtB"}