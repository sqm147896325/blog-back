import{F as n,a as m,b as u,c as d}from"./Form.4c1e3438.js";import{n as c}from"./index.303c07b0.js";import"./request.170a7db9.js";import"./vendor.53200e5a.js";var f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"login"},[i("div",{staticClass:"title"},[e._v("LS\u540E\u53F0")]),i("div",{staticClass:"card"},[i("el-form",{ref:"loginForm",staticClass:"loginForm",attrs:{model:e.loginInfo,rules:e.rules}},[i("el-form-item",{staticClass:"item",attrs:{prop:"id"}},[i("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165id\u6216\u90AE\u7BB1"},nativeOn:{keyup:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.loginInfo.id,callback:function(r){e.$set(e.loginInfo,"id",r)},expression:"loginInfo.id"}},[i("template",{slot:"prepend"},[e._v("\u8D26\u53F7")])],2)],1),i("el-form-item",{staticClass:"item",attrs:{prop:"password"}},[i("el-input",{attrs:{placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","show-password":""},nativeOn:{keyup:function(r){return!r.type.indexOf("key")&&e._k(r.keyCode,"enter",13,r.key,"Enter")?null:e.login.apply(null,arguments)}},model:{value:e.loginInfo.password,callback:function(r){e.$set(e.loginInfo,"password",r)},expression:"loginInfo.password"}},[i("template",{slot:"prepend"},[e._v("\u5BC6\u7801")])],2)],1),i("div",{staticClass:"item-button"},[i("el-button",{staticClass:"login-btn",attrs:{type:"info"},on:{click:e.login}},[e._v("\u767B\u5F55")]),i("div",{staticClass:"function-btn",attrs:{size:"small",type:"text"},on:{click:e.registerOrForget}},[e._v("\u6CE8\u518C/\u5FD8\u8BB0\u5BC6\u7801")])],1)],1)],1),i("my-form",{ref:"myForm",attrs:{title:e.title,formdata:e.formdata,row:e.bindData,rules:e.rules,visible:e.dialogVisible},on:{"update:visible":function(r){e.dialogVisible=r},cancelForm:e.handleClose,submitFrom:e.submitFrom},scopedSlots:e._u([{key:"verification",fn:function(r){var s=r.allRow,o=r.rowKey;return[i("el-input",{model:{value:s[o],callback:function(l){e.$set(s,o,l)},expression:"allRow[rowKey]"}},[i("el-button",{attrs:{slot:"append",disabled:e.verificationText!=="\u83B7\u53D6\u9A8C\u8BC1\u7801",loading:e.verificationText==="loading"},on:{click:e.getVerification},slot:"append"},[e._v(e._s(["\u83B7\u53D6\u9A8C\u8BC1\u7801","loading"].includes(e.verificationText)?"\u83B7\u53D6\u9A8C\u8BC1\u7801":e.verificationText+"\u79D2\u540E\u53EF\u518D\u6B21\u83B7\u53D6"))])],1)]}}])})],1)},g=[];const p={name:"login",components:{"my-form":n},data(){return{loginInfo:{id:new String,password:new String},rules:{id:[{required:!0,message:"\u8BF7\u8F93\u5165id\u6216\u90AE\u7BB1",trigger:"blur"},{min:1,message:"\u8BF7\u8F93\u5165\u8D26\u53F7id\u6216\u7ED1\u5B9A\u90AE\u7BB1",trigger:"blur"}],email:[{required:!0,message:"\u8BF7\u8F93\u5165\u90AE\u7BB1",trigger:"blur"},{type:"email",message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:["blur","change"]}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"},{min:6,max:20,message:"\u5BC6\u7801\u57286-20\u4E2A\u5B57\u7B26",trigger:"blur"}],rePassword:[{required:!0,validator:this.reSure,trigger:"blur"}],verification:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"},{min:4,max:4,message:"\u9A8C\u8BC1\u7801\u4E3A4\u4E2A\u5B57\u7B26",trigger:"blur"}]},formdata:{email:{label:"\u90AE\u7BB1",value:""},verification:{label:"\u9A8C\u8BC1\u7801",value:""},password:{label:"\u5BC6\u7801",value:"",type:"password"},rePassword:{label:"\u786E\u8BA4\u5BC6\u7801",value:"",type:"password"}},bindData:{username:"",email:"",password:"",rePassword:""},title:"\u6CE8\u518C",verificationText:"\u83B7\u53D6\u9A8C\u8BC1\u7801",dialogVisible:!1,verificationData:""}},mounted(){this.init()},methods:{init(){},login(){this.$refs.loginForm.validate(async e=>{if(!e)console.log("[login] \u6821\u9A8C\u5931\u8D25");else{let t=await m(this.loginInfo);if((t==null?void 0:t.flag)==1){localStorage.setItem("token",t.dataInfo.token);let i=t.dataInfo.userInfo;localStorage.setItem("userInfo",JSON.stringify(i)),this.$store.commit("user/setUserInfo",i),this.$router.push("/"),this.$message.success("\u767B\u5F55\u6210\u529F")}}})},registerOrForget(){this.dialogVisible=!0,this.title="\u6CE8\u518C/\u5FD8\u8BB0\u5BC6\u7801"},handleClose(){},async submitFrom(e,t){await u({email:e.email,verification:e.verification,password:e.password})},reSure(e,t,i){console.log(this.$refs.myForm),t===""?i(new Error("\u8BF7\u518D\u6B21\u8F93\u5165\u5BC6\u7801")):t!==this.$refs.myForm.rowData.password?i(new Error("\u4E24\u6B21\u8F93\u5165\u5BC6\u7801\u4E0D\u4E00\u81F4")):i()},async getVerification(){this.$refs.myForm.$refs.form.validateField("email",async e=>{e?this.$message.error("\u8BF7\u5148\u8F93\u5165\u6B63\u786E\u90AE\u7BB1"):(d({email:this.$refs.myForm.rowData.email}).then(()=>{this.verificationText=60;let t=setInterval(()=>{this.verificationText--,this.verificationText===0&&(this.verificationText="\u83B7\u53D6\u9A8C\u8BC1\u7801",clearInterval(t))},1e3)}).catch(()=>{this.verificationText="\u83B7\u53D6\u9A8C\u8BC1\u7801"}),this.verificationText="loading")})}}},a={};var v=c(p,f,g,!1,y,"4408875c",null,null);function y(e){for(let t in a)this[t]=a[t]}var x=function(){return v.exports}();export{x as default};
//# sourceMappingURL=login.be7a2344.js.map
